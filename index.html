<!DOCTYPE html>
<html lang="ar" id="htmlRoot" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>CipherVault 3D Pro - Military Grade File Encryption</title>
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content="CipherVault Pro">
    <meta name="apple-mobile-web-app-title" content="CipherVault">
    <meta name="theme-color" content="#050510">
    <meta name="msapplication-TileColor" content="#050510">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="description" content="Military-grade file encryption in your browser. AES-256-GCM + Zero-knowledge architecture. Supports files up to 10GB.">
    <meta name="keywords" content="encryption, security, military, files, AES-256, privacy, 10GB">
    <meta name="author" content="CipherVault Security Team">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net 'unsafe-inline' 'unsafe-eval'; style-src 'self' https://cdnjs.cloudflare.com https://fonts.googleapis.com 'unsafe-inline'; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com; connect-src 'self'; img-src 'self' data: https:;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/x-icon" href="assets/icons/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/icons/apple-touch-icon.png">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/mobile-optimized.css">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" as="script" crossorigin>
    <link rel="preload" href="assets/js/main-enhanced.js" as="script">
    <link rel="preload" href="assets/js/crypto-core-enhanced.js" as="script">
    
    <!-- Polyfills for maximum browser compatibility -->
    <script>
        // Browser compatibility detection
        window.browserCompatibility = {
            hasCrypto: typeof crypto !== 'undefined' && crypto.subtle,
            hasWorkers: typeof Worker !== 'undefined',
            hasStreams: typeof ReadableStream !== 'undefined',
            hasWebGL: (() => {
                try {
                    const canvas = document.createElement('canvas');
                    return !!(window.WebGLRenderingContext && 
                        (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));
                } catch (e) { return false; }
            })(),
            deviceMemory: navigator.deviceMemory || 4,
            hardwareConcurrency: navigator.hardwareConcurrency || 4,
            isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
            isLowEnd: function() {
                return this.deviceMemory < 4 || this.hardwareConcurrency < 4;
            }
        };
        
        // Load polyfills dynamically
        if (!window.browserCompatibility.hasCrypto || 
            !window.browserCompatibility.hasWorkers) {
            document.write('<script src="https://cdn.polyfill.io/v3/polyfill.min.js?features=es6,es7,es2018,es2019,fetch,Promise,Symbol,Symbol.iterator,Symbol.asyncIterator,Array.prototype.includes,Object.assign,Object.values,Object.entries,String.prototype.padStart,String.prototype.padEnd,Number.isFinite,Number.isInteger,Number.isNaN,Math.trunc,Math.sign,WeakMap,WeakSet,Set,Map,Reflect,URL,URLSearchParams,TextEncoder,TextDecoder,crypto.getRandomValues"><\/script>');
        }
    </script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-logo">
                <i class="fas fa-shield-alt"></i>
            </div>
            <h2>CipherVault 3D Pro</h2>
            <p>Initializing military-grade encryption system...</p>
            <div class="loading-progress">
                <div class="progress-bar"></div>
            </div>
            <div class="loading-details">
                <span id="loadingStatus">Checking compatibility...</span>
                <span id="loadingProgress">0%</span>
            </div>
        </div>
    </div>

    <!-- Three.js Canvas -->
    <div id="threejs-container"></div>
    
    <!-- 3D Floating Elements -->
    <div class="floating-elements">
        <div class="floating-icon" style="top: 10%; left: 5%; animation-delay: 0s;">
            <i class="fas fa-shield-alt"></i>
        </div>
        <div class="floating-icon" style="top: 20%; right: 10%; animation-delay: 1s;">
            <i class="fas fa-lock"></i>
        </div>
        <div class="floating-icon" style="bottom: 30%; left: 15%; animation-delay: 2s;">
            <i class="fas fa-key"></i>
        </div>
        <div class="floating-icon" style="bottom: 15%; right: 5%; animation-delay: 3s;">
            <i class="fas fa-file-shield"></i>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container" style="display: none;">
        <!-- Security Status Bar -->
        <div class="security-status-bar">
            <div class="security-indicators">
                <div class="security-indicator" id="securityHttps" title="HTTPS Connection">
                    <i class="fas fa-lock"></i>
                </div>
                <div class="security-indicator" id="securityCrypto" title="Crypto API">
                    <i class="fas fa-microchip"></i>
                </div>
                <div class="security-indicator" id="securityWorkers" title="Web Workers">
                    <i class="fas fa-cogs"></i>
                </div>
                <div class="security-indicator" id="securityStorage" title="Secure Storage">
                    <i class="fas fa-database"></i>
                </div>
                <div class="security-indicator" id="securityMemory" title="Memory Protection">
                    <i class="fas fa-memory"></i>
                </div>
            </div>
            <div class="security-level-display">
                <span class="security-label" data-i18n="security-level">Security Level:</span>
                <span class="security-value" id="securityLevelValue">INITIALIZING...</span>
            </div>
        </div>

        <!-- Language & Settings Selector -->
        <div class="control-panel-3d">
            <div class="language-selector-3d">
                <div class="lang-option" data-lang="ar" data-tooltip="العربية">
                    <i class="fas fa-globe-africa"></i>
                    <span>AR</span>
                </div>
                <div class="lang-option active" data-lang="en" data-tooltip="English">
                    <i class="fas fa-globe-americas"></i>
                    <span>EN</span>
                </div>
            </div>
            
            <div class="settings-controls">
                <button class="control-btn" id="toggleDarkMode" data-tooltip="Toggle Dark Mode">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="control-btn" id="toggleAdvanced" data-tooltip="Advanced Settings">
                    <i class="fas fa-sliders-h"></i>
                </button>
                <button class="control-btn" id="toggleSecurity" data-tooltip="Security Audit">
                    <i class="fas fa-user-secret"></i>
                </button>
                <button class="control-btn" id="togglePerformance" data-tooltip="Performance Mode">
                    <i class="fas fa-tachometer-alt"></i>
                </button>
            </div>
        </div>

        <!-- 3D Logo -->
        <div class="logo-3d">
            <div class="logo-icon-3d">
                <div class="cube-logo">
                    <div class="face front">
                        <i class="fas fa-lock"></i>
                    </div>
                    <div class="face back">
                        <i class="fas fa-key"></i>
                    </div>
                    <div class="face right">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="face left">
                        <i class="fas fa-database"></i>
                    </div>
                    <div class="face top">
                        <i class="fas fa-cloud"></i>
                    </div>
                    <div class="face bottom">
                        <i class="fas fa-code"></i>
                    </div>
                </div>
            </div>
            <h1 class="logo-text" data-i18n="app-title">CIPHERVAULT 3D PRO</h1>
            <p class="tagline" data-i18n="tagline">Military-Grade Encryption · Zero Trust Architecture · Up to 10GB Files</p>
        </div>

        <!-- Advanced Settings Panel (Hidden by default) -->
        <div class="advanced-settings-panel" id="advancedSettingsPanel">
            <div class="settings-container">
                <div class="settings-header">
                    <h3><i class="fas fa-cogs"></i> Advanced Security Settings</h3>
                    <button class="close-settings" id="closeAdvancedSettings">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="settings-content">
                    <div class="settings-group">
                        <h4><i class="fas fa-shield-alt"></i> Security Level</h4>
                        <div class="security-levels">
                            <div class="security-level-option" data-level="BASIC">
                                <div class="level-icon">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <div class="level-info">
                                    <h5>Basic</h5>
                                    <p>Fast encryption for non-sensitive files</p>
                                    <ul>
                                        <li>AES-256-GCM</li>
                                        <li>100K iterations</li>
                                        <li>Single layer</li>
                                        <li>Up to 1GB files</li>
                                    </ul>
                                </div>
                                <div class="level-selector">
                                    <input type="radio" name="securityLevel" value="BASIC">
                                </div>
                            </div>
                            
                            <div class="security-level-option" data-level="MEDIUM">
                                <div class="level-icon">
                                    <i class="fas fa-balance-scale"></i>
                                </div>
                                <div class="level-info">
                                    <h5>Medium</h5>
                                    <p>Balanced security for most files</p>
                                    <ul>
                                        <li>AES-256-GCM + ChaCha20</li>
                                        <li>310K iterations</li>
                                        <li>Dual layer encryption</li>
                                        <li>Up to 5GB files</li>
                                    </ul>
                                </div>
                                <div class="level-selector">
                                    <input type="radio" name="securityLevel" value="MEDIUM" checked>
                                </div>
                            </div>
                            
                            <div class="security-level-option" data-level="HIGH">
                                <div class="level-icon">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <div class="level-info">
                                    <h5>High</h5>
                                    <p>Maximum security for sensitive data</p>
                                    <ul>
                                        <li>AES-256-GCM + AES-CBC + ChaCha20</li>
                                        <li>600K iterations</li>
                                        <li>Three layers with obfuscation</li>
                                        <li>Up to 10GB files</li>
                                    </ul>
                                </div>
                                <div class="level-selector">
                                    <input type="radio" name="securityLevel" value="HIGH">
                                </div>
                            </div>
                            
                            <div class="security-level-option" data-level="MILITARY">
                                <div class="level-icon">
                                    <i class="fas fa-user-secret"></i>
                                </div>
                                <div class="level-info">
                                    <h5>Military</h5>
                                    <p>Ultimate protection for classified data</p>
                                    <ul>
                                        <li>Quadruple encryption layers</li>
                                        <li>1M iterations PBKDF2</li>
                                        <li>Obfuscation + anti-timing</li>
                                        <li>Memory wipe protection</li>
                                        <li>Up to 10GB files</li>
                                    </ul>
                                </div>
                                <div class="level-selector">
                                    <input type="radio" name="securityLevel" value="MILITARY">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h4><i class="fas fa-tachometer-alt"></i> Performance Settings</h4>
                        <div class="performance-options">
                            <div class="option-row">
                                <label>
                                    <input type="checkbox" id="useWorkers" checked>
                                    <span>Use Web Workers for parallel processing</span>
                                    <span class="option-desc">Recommended for files > 100MB</span>
                                </label>
                            </div>
                            <div class="option-row">
                                <label>
                                    <input type="checkbox" id="enableCompression" checked>
                                    <span>Compress before encryption</span>
                                    <span class="option-desc">Reduces file size (except media)</span>
                                </label>
                            </div>
                            <div class="option-row">
                                <label>
                                    <input type="checkbox" id="enableWipe" checked>
                                    <span>Secure memory wipe after operations</span>
                                    <span class="option-desc">Overwrites memory 3 times</span>
                                </label>
                            </div>
                            <div class="option-row">
                                <label>
                                    <input type="checkbox" id="enableStreaming" checked>
                                    <span>Stream processing for large files</span>
                                    <span class="option-desc">Required for files > 1GB</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-group">
                        <h4><i class="fas fa-user-shield"></i> Privacy Settings</h4>
                        <div class="privacy-options">
                            <div class="option-row">
                                <label>
                                    <input type="checkbox" id="autoClear" checked>
                                    <span>Auto-clear passwords after use</span>
                                    <span class="option-desc">Immediately clears password from memory</span>
                                </label>
                            </div>
                            <div class="option-row">
                                <label>
                                    <input type="checkbox" id="disableLogging">
                                    <span>Disable security logging</span>
                                    <span class="option-desc">Not recommended for sensitive operations</span>
                                </label>
                            </div>
                            <div class="option-row">
                                <label>
                                    <input type="checkbox" id="sessionTimeout" checked>
                                    <span>Session timeout after 15 minutes</span>
                                    <span class="option-desc">Automatically locks the application</span>
                                </label>
                            </div>
                            <div class="option-row">
                                <label>
                                    <input type="checkbox" id="hideFilenames">
                                    <span>Hide original filenames</span>
                                    <span class="option-desc">Encrypts metadata for additional privacy</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-footer">
                    <button class="btn-save-settings" id="saveSettings">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                    <button class="btn-reset-settings" id="resetSettings">
                        <i class="fas fa-redo"></i> Reset to Defaults
                    </button>
                </div>
            </div>
        </div>

        <!-- 3D Card Container -->
        <div class="card-container-3d">
            <!-- Encrypt Card -->
            <div class="card-3d encrypt-card">
                <div class="card-inner">
                    <div class="card-front">
                        <div class="card-header">
                            <div class="card-icon-3d">
                                <i class="fas fa-lock"></i>
                            </div>
                            <h2 data-i18n="encrypt-title">ENCRYPT FILE</h2>
                            <div class="tech-badge">
                                <i class="fas fa-microchip"></i>
                                <span>AES-256-GCM</span>
                            </div>
                        </div>
                        
                        <div class="file-upload-3d" id="encryptUpload">
                            <div class="upload-area">
                                <div class="upload-icon">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                </div>
                                <p class="upload-text" data-i18n="choose-file">Drag & Drop or Click to Select File</p>
                                <p class="file-types" data-i18n="supported-files">Supports ALL file types up to 10GB</p>
                                <div class="upload-progress" id="encryptUploadProgress">
                                    <div class="progress-bar"></div>
                                </div>
                            </div>
                            <input type="file" id="fileInputEncrypt" style="display: none;">
                        </div>

                        <div class="file-info-3d" id="encryptFileInfo">
                            <div class="file-details">
                                <div class="file-icon">
                                    <i class="fas fa-file"></i>
                                </div>
                                <div class="file-text">
                                    <span id="encryptFileName" class="filename">No file selected</span>
                                    <span id="encryptFileSize" class="filesize">0 MB</span>
                                    <span id="encryptFileType" class="filetype"></span>
                                </div>
                            </div>
                            <div class="file-actions">
                                <button class="btn-icon" onclick="CipherVault.clearFile('encrypt')" data-tooltip="Clear File">
                                    <i class="fas fa-times"></i>
                                </button>
                                <button class="btn-icon" onclick="CipherVault.showFileInfo('encrypt')" data-tooltip="File Details">
                                    <i class="fas fa-info-circle"></i>
                                </button>
                                <button class="btn-icon" onclick="CipherVault.analyzeFile('encrypt')" data-tooltip="Analyze File">
                                    <i class="fas fa-chart-bar"></i>
                                </button>
                            </div>
                        </div>

                        <div class="password-input-3d">
                            <div class="input-header">
                                <label data-i18n="password-label">PASSWORD (MINIMUM 12 CHARACTERS)</label>
                                <div class="strength-meter" id="passwordStrengthEncrypt">
                                    <div class="strength-visual">
                                        <span class="strength-bar weak"></span>
                                        <span class="strength-bar medium"></span>
                                        <span class="strength-bar strong"></span>
                                        <span class="strength-bar very-strong"></span>
                                    </div>
                                    <span class="strength-text" data-i18n="password-weak">WEAK</span>
                                </div>
                            </div>
                            <div class="input-wrapper">
                                <input type="password" id="passwordEncrypt" 
                                       placeholder="Enter strong password (12+ characters)..."
                                       autocomplete="new-password"
                                       minlength="12">
                                <button class="btn-toggle-password" onclick="CipherVault.togglePassword('passwordEncrypt')"
                                        data-tooltip="Show/Hide Password">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-generate-password" onclick="CipherVault.generatePassword()"
                                        data-tooltip="Generate Secure Password">
                                    <i class="fas fa-random"></i>
                                </button>
                                <div class="password-hints">
                                    <span class="hint" id="hintLength">12+ chars</span>
                                    <span class="hint" id="hintUpper">Uppercase</span>
                                    <span class="hint" id="hintLower">Lowercase</span>
                                    <span class="hint" id="hintNumbers">Numbers</span>
                                    <span class="hint" id="hintSymbols">Symbols</span>
                                    <span class="hint" id="hintEntropy">Entropy</span>
                                </div>
                            </div>
                        </div>

                        <div class="password-confirm-input" id="passwordConfirmSection">
                            <div class="input-header">
                                <label data-i18n="confirm-password">CONFIRM PASSWORD</label>
                            </div>
                            <div class="input-wrapper">
                                <input type="password" id="passwordConfirm" 
                                       placeholder="Re-enter password..."
                                       autocomplete="new-password">
                                <button class="btn-toggle-password" onclick="CipherVault.togglePassword('passwordConfirm')"
                                        data-tooltip="Show/Hide Password">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <div class="password-match" id="passwordMatchIndicator">
                                    <i class="fas fa-check-circle"></i>
                                    <span data-i18n="passwords-match">Passwords match</span>
                                </div>
                            </div>
                        </div>

                        <div class="security-level-selector">
                            <h4><i class="fas fa-shield-alt"></i> Encryption Level</h4>
                            <div class="level-buttons">
                                <button class="level-btn" data-level="BASIC">Basic</button>
                                <button class="level-btn active" data-level="MEDIUM">Medium</button>
                                <button class="level-btn" data-level="HIGH">High</button>
                                <button class="level-btn" data-level="MILITARY">Military</button>
                            </div>
                        </div>

                        <div class="encryption-options">
                            <div class="option">
                                <input type="checkbox" id="compressOption" checked>
                                <label for="compressOption" data-i18n="compress-option">
                                    <i class="fas fa-compress-alt"></i>
                                    Compress before encryption
                                    <span class="option-desc">(Except for already compressed files)</span>
                                </label>
                            </div>
                            <div class="option">
                                <input type="checkbox" id="splitOption" data-tooltip="Split files > 2GB for better compatibility">
                                <label for="splitOption" data-i18n="split-option">
                                    <i class="fas fa-cut"></i>
                                    Split large files (>2GB)
                                </label>
                            </div>
                            <div class="option">
                                <input type="checkbox" id="integrityOption" checked>
                                <label for="integrityOption" data-i18n="verify-option">
                                    <i class="fas fa-check-double"></i>
                                    Verify file integrity (HMAC-SHA512)
                                </label>
                            </div>
                            <div class="option">
                                <input type="checkbox" id="wipeOption" checked>
                                <label for="wipeOption" data-i18n="wipe-option">
                                    <i class="fas fa-eraser"></i>
                                    Secure memory wipe
                                </label>
                            </div>
                        </div>

                        <div class="encryption-actions">
                            <button class="btn-3d btn-encrypt" id="encryptBtn" disabled>
                                <div class="btn-content">
                                    <i class="fas fa-lock"></i>
                                    <span data-i18n="encrypt-btn">ENCRYPT NOW</span>
                                </div>
                                <div class="btn-glow"></div>
                                <div class="btn-progress" id="encryptBtnProgress"></div>
                            </button>
                            <div class="action-info">
                                <i class="fas fa-info-circle"></i>
                                <span>Estimated time: <span id="encryptTimeEstimate">Calculating...</span></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card-back">
                        <div class="progress-3d" id="encryptProgress">
                            <div class="progress-circle">
                                <svg width="140" height="140" viewBox="0 0 140 140">
                                    <circle class="progress-bg" cx="70" cy="70" r="64"></circle>
                                    <circle class="progress-bar" cx="70" cy="70" r="64" 
                                            style="stroke-dashoffset: 402.124;"></circle>
                                </svg>
                                <div class="progress-text">
                                    <span id="encryptProgressPercent">0</span>
                                    <span>%</span>
                                </div>
                                <div class="progress-status">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    <span id="encryptProgressStatus" data-i18n="processing">INITIALIZING...</span>
                                </div>
                            </div>
                            <div class="progress-details">
                                <div class="detail">
                                    <i class="fas fa-microchip"></i>
                                    <span class="detail-label">Algorithm</span>
                                    <span class="detail-value" id="encryptAlgo">AES-256-GCM</span>
                                </div>
                                <div class="detail">
                                    <i class="fas fa-redo"></i>
                                    <span class="detail-label">PBKDF2 Iterations</span>
                                    <span class="detail-value" id="encryptIterations">310,000</span>
                                </div>
                                <div class="detail">
                                    <i class="fas fa-fingerprint"></i>
                                    <span class="detail-label">HMAC</span>
                                    <span class="detail-value" id="encryptHmac">SHA-512</span>
                                </div>
                                <div class="detail">
                                    <i class="fas fa-layer-group"></i>
                                    <span class="detail-label">Layers</span>
                                    <span class="detail-value" id="encryptLayers">2</span>
                                </div>
                            </div>
                            <div class="progress-stats">
                                <div class="stat">
                                    <span class="stat-label">Time Elapsed:</span>
                                    <span class="stat-value" id="encryptTime">00:00</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Data Processed:</span>
                                    <span class="stat-value" id="encryptData">0 MB / 0 MB</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Speed:</span>
                                    <span class="stat-value" id="encryptSpeed">0 MB/s</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Memory Usage:</span>
                                    <span class="stat-value" id="encryptMemory">0 MB</span>
                                </div>
                            </div>
                            <div class="progress-actions">
                                <button class="btn-progress-action" id="pauseEncrypt" data-tooltip="Pause Encryption">
                                    <i class="fas fa-pause"></i>
                                </button>
                                <button class="btn-progress-action" id="cancelEncrypt" data-tooltip="Cancel Encryption">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Decrypt Card -->
            <div class="card-3d decrypt-card">
                <div class="card-inner">
                    <div class="card-front">
                        <div class="card-header">
                            <div class="card-icon-3d">
                                <i class="fas fa-unlock"></i>
                            </div>
                            <h2 data-i18n="decrypt-title">DECRYPT FILE</h2>
                            <div class="tech-badge">
                                <i class="fas fa-shield-check"></i>
                                <span>SECURE DECRYPTION</span>
                            </div>
                        </div>
                        
                        <div class="file-upload-3d" id="decryptUpload">
                            <div class="upload-area">
                                <div class="upload-icon">
                                    <i class="fas fa-file-import"></i>
                                </div>
                                <p class="upload-text" data-i18n="choose-encrypted-file">Select .cvault encrypted file</p>
                                <p class="file-types" data-i18n="encrypted-only">Encrypted files only (.cvault, .cvenc, .cvmil)</p>
                                <div class="upload-progress" id="decryptUploadProgress">
                                    <div class="progress-bar"></div>
                                </div>
                            </div>
                            <input type="file" id="fileInputDecrypt" style="display: none;" accept=".cvault,.cvenc,.cvmil,.cv10g">
                        </div>

                        <div class="file-info-3d" id="decryptFileInfo">
                            <div class="file-details">
                                <div class="file-icon">
                                    <i class="fas fa-file-shield"></i>
                                </div>
                                <div class="file-text">
                                    <span id="decryptFileName" class="filename">No file selected</span>
                                    <span id="decryptFileSize" class="filesize">0 MB</span>
                                    <span id="decryptFileType" class="filetype">Unknown</span>
                                </div>
                            </div>
                            <div class="file-actions">
                                <button class="btn-icon" onclick="CipherVault.clearFile('decrypt')" data-tooltip="Clear File">
                                    <i class="fas fa-times"></i>
                                </button>
                                <button class="btn-icon" onclick="CipherVault.showFileInfo('decrypt')" data-tooltip="File Details">
                                    <i class="fas fa-info-circle"></i>
                                </button>
                                <button class="btn-icon" onclick="CipherVault.analyzeEncryptedFile()" data-tooltip="Analyze Encryption">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>

                        <div class="password-input-3d">
                            <div class="input-header">
                                <label data-i18n="password-label-decrypt">ENCRYPTION PASSWORD</label>
                                <div class="password-hint" id="decryptPasswordHint">
                                    <i class="fas fa-key"></i>
                                    <span>Enter the exact password used for encryption</span>
                                </div>
                            </div>
                            <div class="input-wrapper">
                                <input type="password" id="passwordDecrypt" 
                                       placeholder="Enter encryption password..."
                                       autocomplete="current-password">
                                <button class="btn-toggle-password" onclick="CipherVault.togglePassword('passwordDecrypt')"
                                        data-tooltip="Show/Hide Password">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <div class="password-recovery" id="passwordRecovery">
                                    <i class="fas fa-life-ring"></i>
                                    <span data-i18n="password-recovery">Forgot password? Use recovery shards</span>
                                </div>
                            </div>
                        </div>

                        <div class="decryption-info" id="decryptionInfo">
                            <div class="info-item">
                                <i class="fas fa-shield-alt"></i>
                                <span>Security Level: <strong id="fileSecurityLevel">Unknown</strong></span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-layer-group"></i>
                                <span>Encryption Layers: <strong id="fileLayers">Unknown</strong></span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-calendar"></i>
                                <span>Encrypted: <strong id="fileEncryptedDate">Unknown</strong></span>
                            </div>
                        </div>

                        <div class="decryption-options">
                            <div class="option">
                                <input type="checkbox" id="verifyIntegrity" checked>
                                <label for="verifyIntegrity" data-i18n="verify-option">
                                    <i class="fas fa-shield-check"></i>
                                    Verify file integrity
                                    <span class="option-desc">(HMAC verification)</span>
                                </label>
                            </div>
                            <div class="option">
                                <input type="checkbox" id="wipeAfter" checked>
                                <label for="wipeAfter" data-i18n="wipe-option">
                                    <i class="fas fa-eraser"></i>
                                    Secure memory wipe
                                </label>
                            </div>
                            <div class="option">
                                <input type="checkbox" id="keepMetadata">
                                <label for="keepMetadata" data-i18n="keep-metadata">
                                    <i class="fas fa-info-circle"></i>
                                    Preserve file metadata
                                </label>
                            </div>
                            <div class="option">
                                <input type="checkbox" id="autoOpen">
                                <label for="autoOpen" data-i18n="auto-open">
                                    <i class="fas fa-folder-open"></i>
                                    Open file after decryption
                                </label>
                            </div>
                        </div>

                        <div class="decryption-actions">
                            <button class="btn-3d btn-decrypt" id="decryptBtn" disabled>
                                <div class="btn-content">
                                    <i class="fas fa-unlock"></i>
                                    <span data-i18n="decrypt-btn">DECRYPT NOW</span>
                                </div>
                                <div class="btn-glow"></div>
                                <div class="btn-progress" id="decryptBtnProgress"></div>
                            </button>
                            <div class="action-info">
                                <i class="fas fa-clock"></i>
                                <span>Estimated time: <span id="decryptTimeEstimate">Calculating...</span></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card-back">
                        <div class="progress-3d" id="decryptProgress">
                            <div class="progress-circle">
                                <svg width="140" height="140" viewBox="0 0 140 140">
                                    <circle class="progress-bg" cx="70" cy="70" r="64"></circle>
                                    <circle class="progress-bar" cx="70" cy="70" r="64" 
                                            style="stroke-dashoffset: 402.124;"></circle>
                                </svg>
                                <div class="progress-text">
                                    <span id="decryptProgressPercent">0</span>
                                    <span>%</span>
                                </div>
                                <div class="progress-status">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    <span id="decryptProgressStatus" data-i18n="processing-decrypt">INITIALIZING...</span>
                                </div>
                            </div>
                            <div class="progress-details">
                                <div class="detail">
                                    <i class="fas fa-shield-check"></i>
                                    <span class="detail-label">Integrity Check</span>
                                    <span class="detail-value" id="decryptIntegrity">Pending...</span>
                                </div>
                                <div class="detail">
                                    <i class="fas fa-memory"></i>
                                    <span class="detail-label">Memory Safe</span>
                                    <span class="detail-value" id="decryptMemory">Active</span>
                                </div>
                                <div class="detail">
                                    <i class="fas fa-bolt"></i>
                                    <span class="detail-label">Processing Speed</span>
                                    <span class="detail-value" id="decryptSpeed">Optimized</span>
                                </div>
                                <div class="detail">
                                    <i class="fas fa-layer-group"></i>
                                    <span class="detail-label">Layers</span>
                                    <span class="detail-value" id="decryptLayers">0/3</span>
                                </div>
                            </div>
                            <div class="progress-stats">
                                <div class="stat">
                                    <span class="stat-label">Time Elapsed:</span>
                                    <span class="stat-value" id="decryptTime">00:00</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Layers Decrypted:</span>
                                    <span class="stat-value" id="decryptLayersProgress">0/3</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Security Level:</span>
                                    <span class="stat-value" id="decryptSecurity">Unknown</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Memory Usage:</span>
                                    <span class="stat-value" id="decryptMemoryUsage">0 MB</span>
                                </div>
                            </div>
                            <div class="progress-actions">
                                <button class="btn-progress-action" id="pauseDecrypt" data-tooltip="Pause Decryption">
                                    <i class="fas fa-pause"></i>
                                </button>
                                <button class="btn-progress-action" id="cancelDecrypt" data-tooltip="Cancel Decryption">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Messages 3D -->
        <div class="status-3d" id="status-container">
            <!-- سيتم إنشاء الإشعارات ديناميكياً -->
        </div>

        <!-- Recovery Shard Manager -->
        <div class="recovery-panel" id="recoveryPanel">
            <div class="recovery-container">
                <div class="recovery-header">
                    <h3><i class="fas fa-puzzle-piece"></i> Password Recovery System</h3>
                    <button class="close-recovery" id="closeRecovery">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="recovery-content">
                    <div class="recovery-info">
                        <p><i class="fas fa-info-circle"></i> Your password is split into 5 recovery shards using Shamir's Secret Sharing algorithm. You need at least 3 shards to recover access.</p>
                    </div>
                    <div class="shards-container">
                        <!-- سيتم إنشاء الأجزاء ديناميكياً -->
                    </div>
                    <div class="recovery-actions">
                        <button class="btn-recovery" id="uploadShards">
                            <i class="fas fa-upload"></i> Upload Shard Files
                        </button>
                        <button class="btn-recovery" id="enterShardCodes">
                            <i class="fas fa-keyboard"></i> Enter Shard Codes
                        </button>
                        <button class="btn-recovery" id="generateShards">
                            <i class="fas fa-plus-circle"></i> Generate New Shards
                        </button>
                        <button class="btn-recovery" id="recoverPassword" disabled>
                            <i class="fas fa-unlock-alt"></i> Recover Password
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3D Stats Panel -->
        <div class="stats-panel-3d">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-value" id="filesProcessed">0</span>
                    <span class="stat-label" data-i18n="files-processed">Files Processed</span>
                </div>
                <div class="stat-trend">
                    <i class="fas fa-arrow-up"></i>
                    <span>0%</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-database"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-value" id="dataEncrypted">0 MB</span>
                    <span class="stat-label" data-i18n="data-encrypted">Data Encrypted</span>
                </div>
                <div class="stat-trend">
                    <i class="fas fa-arrow-up"></i>
                    <span>0%</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-bolt"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-value" id="encryptionSpeed">0 MB/s</span>
                    <span class="stat-label" data-i18n="avg-speed">Avg Speed</span>
                </div>
                <div class="stat-trend">
                    <i class="fas fa-arrow-up"></i>
                    <span>0%</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-value" id="securityLevel">STANDARD</span>
                    <span class="stat-label">Security Level</span>
                </div>
                <div class="stat-trend">
                    <i class="fas fa-check-circle"></i>
                    <span>Active</span>
                </div>
            </div>
        </div>

        <!-- Security Badges -->
        <div class="security-badges-3d">
            <div class="badge" data-tooltip="Military Grade AES-256-GCM + ChaCha20-Poly1305 Encryption">
                <i class="fas fa-user-secret"></i>
                <span>AES-256 + ChaCha20</span>
            </div>
            <div class="badge" data-tooltip="Zero Knowledge Architecture - No Data Leaves Your Browser">
                <i class="fas fa-eye-slash"></i>
                <span>Zero-Knowledge</span>
            </div>
            <div class="badge" data-tooltip="Supports Files Up to 10GB - All File Types">
                <i class="fas fa-file-archive"></i>
                <span>Up to 10GB</span>
            </div>
            <div class="badge" data-tooltip="PWA - Install as Native App - Works Offline">
                <i class="fas fa-mobile-alt"></i>
                <span>PWA Ready</span>
            </div>
            <div class="badge" data-tooltip="Password Recovery System - 5 Shards, 3 Required">
                <i class="fas fa-puzzle-piece"></i>
                <span>Recovery System</span>
            </div>
        </div>

        <!-- PWA Install Prompt -->
        <div class="pwa-install-prompt" id="pwaInstallPrompt">
            <div class="pwa-content">
                <div class="pwa-icon">
                    <i class="fas fa-download"></i>
                </div>
                <div class="pwa-info">
                    <h4>Install CipherVault Pro</h4>
                    <p>Install as app for better experience and offline access</p>
                </div>
                <div class="pwa-actions">
                    <button class="btn-pwa-install" id="installPWA">
                        <i class="fas fa-plus-circle"></i> Install
                    </button>
                    <button class="btn-pwa-dismiss" id="dismissPWA">
                        Not Now
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer-3d">
            <div class="footer-content">
                <div class="footer-security">
                    <div class="security-audit">
                        <i class="fas fa-shield-check"></i>
                        <span>Security Audit: <strong id="auditStatus">PASSED</strong></span>
                    </div>
                    <div class="connection-status">
                        <i class="fas fa-wifi" id="connectionIcon"></i>
                        <span id="connectionStatus">Online</span>
                    </div>
                    <div class="memory-status">
                        <i class="fas fa-memory" id="memoryIcon"></i>
                        <span id="memoryStatus">Memory Safe</span>
                    </div>
                </div>
                
                <p class="footer-text" data-i18n="footer-text">
                    <i class="fas fa-code"></i> CipherVault 3D Pro v4.2.0 · 
                    <span data-i18n="engine">Enhanced Three.js Engine</span> · 
                    <span data-i18n="zero-trust">Zero-Trust Architecture</span> ·
                    <span data-i18n="max-files">Supports up to 10GB Files</span>
                </p>
                
                <div class="footer-links">
                    <a href="#" onclick="CipherVault.showSecurityAudit()" data-i18n="security-audit">
                        <i class="fas fa-shield-alt"></i> Security Audit
                    </a>
                    <a href="#" onclick="CipherVault.showPrivacyPolicy()" data-i18n="privacy">
                        <i class="fas fa-user-secret"></i> Privacy
                    </a>
                    <a href="#" onclick="CipherVault.showDocumentation()" data-i18n="docs">
                        <i class="fas fa-book"></i> Documentation
                    </a>
                    <a href="#" onclick="CipherVault.showAbout()" data-i18n="about">
                        <i class="fas fa-info-circle"></i> About
                    </a>
                    <a href="#" onclick="CipherVault.showCompatibilityInfo()" data-i18n="compatibility">
                        <i class="fas fa-check-circle"></i> Compatibility
                    </a>
                </div>
                
                <div class="footer-legal">
                    <span class="copyright">© 2024 CipherVault Pro. All rights reserved.</span>
                    <span class="version">v4.2.0 · Build #2024.01 · Enhanced Edition</span>
                    <span class="compatibility" id="browserCompatibility">Compatible with all modern browsers</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <!-- Core Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanilla-tilt@1.7.0/dist/vanilla-tilt.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pako@2.0.4/dist/pako.min.js"></script>
    
    <!-- Application Scripts (Modular) -->
    <script src="assets/js/config-enhanced.js"></script>
    <script src="assets/js/translations-enhanced.js"></script>
    <script src="assets/js/three-scene-enhanced.js"></script>
    <script src="assets/js/crypto-core-enhanced.js"></script>
    <script src="assets/js/crypto-worker-enhanced.js"></script>
    <script src="assets/js/file-processor-enhanced.js"></script>
    <script src="assets/js/web-workers-manager.js"></script>
    <script src="assets/js/performance-manager.js"></script>
    <script src="assets/js/audit-logger-enhanced.js"></script>
    <script src="assets/js/security-audit-enhanced.js"></script>
    <script src="assets/js/recovery-system-enhanced.js"></script>
    <script src="assets/js/pwa-manager-enhanced.js"></script>
    <script src="assets/js/ui-manager.js"></script>
    <script src="assets/js/browser-compatibility.js"></script>
    <script src="assets/js/main-enhanced.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker-enhanced.js')
                    .then(registration => {
                        console.log('ServiceWorker registered successfully:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('New service worker found:', newWorker);
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('New content is available; please refresh.');
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('ServiceWorker registration failed:', error);
                    });
            });
        }
        
        // Handle offline/online status
        window.addEventListener('online', () => {
            document.getElementById('connectionStatus').textContent = 'Online';
            document.getElementById('connectionIcon').className = 'fas fa-wifi';
        });
        
        window.addEventListener('offline', () => {
            document.getElementById('connectionStatus').textContent = 'Offline';
            document.getElementById('connectionIcon').className = 'fas fa-wifi-slash';
            console.log('Application is offline. Encryption/Decryption will still work.');
        });
    </script>
</body>
</html>
